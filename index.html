<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sk√≥ladagatal - PDF Lesari</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header .school-year {
            color: #666;
            font-size: 18px;
            font-weight: 500;
        }

        .upload-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background: #f8f9ff;
            border-color: #5568d3;
        }

        .upload-area.dragover {
            background: #f0f2ff;
            border-color: #5568d3;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 18px;
            color: #333;
            margin-bottom: 10px;
        }

        .upload-hint {
            font-size: 14px;
            color: #666;
        }

        #fileInput {
            display: none;
        }

        .controls {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
        }

        .controls.visible {
            display: block;
        }

        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .week-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .week-selector select {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .week-selector select:focus {
            outline: none;
            border-color: #667eea;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn, .action-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-btn:hover, .action-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .nav-btn:active, .action-btn:active {
            transform: translateY(0);
        }

        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .action-btn.secondary {
            background: #ff5722;
        }

        .action-btn.secondary:hover {
            background: #e64a19;
        }

        .week-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: fadeIn 0.4s ease;
            display: none;
        }

        .week-card.visible {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .week-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #f0f0f0;
        }

        .week-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 5px;
        }

        .week-dates {
            font-size: 16px;
            color: #666;
        }

        .days-grid {
            display: grid;
            gap: 15px;
        }

        .day-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .day-card:hover {
            background: #f0f2f5;
            transform: translateX(5px);
        }

        .day-card.has-event {
            border-left-color: #667eea;
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
        }

        .day-card.weekend {
            background: #fff8f0;
            border-left-color: #ffa726;
        }

        .day-card.weekend.has-event {
            background: linear-gradient(135deg, #fffaf5 0%, #fff0e5 100%);
            border-left-color: #ff9800;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .day-name {
            font-weight: 600;
            font-size: 18px;
            color: #333;
        }

        .day-date {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .events {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .event-tag {
            background: #667eea;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            display: inline-block;
        }

        .event-tag.special {
            background: #ff5722;
        }

        .event-tag.starfsdagur {
            background: #4caf50;
        }

        .event-tag.fri {
            background: #ff9800;
        }

        .no-events {
            color: #999;
            font-style: italic;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 18px;
        }

        .error {
            background: #ffebee;
            border: 2px solid #f44336;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            color: #c62828;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .control-row {
                flex-direction: column;
            }

            .week-selector {
                width: 100%;
            }

            .nav-buttons {
                width: 100%;
            }

            .nav-btn, .action-btn {
                flex: 1;
            }

            .week-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Sk√≥ladagatal</h1>
            <div class="school-year" id="schoolInfo">Hla√∞i√∞ inn PDF skjali til a√∞ byrja</div>
        </div>

        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìÑ</div>
                <div class="upload-text">Smelltu h√©r e√∞a drag√∞u PDF skjal hinga√∞</div>
                <div class="upload-hint">Sty√∞ur sk√≥ladagat√∂l √° PDF formi</div>
            </div>
            <input type="file" id="fileInput" accept=".pdf">
        </div>

        <div class="controls" id="controls">
            <div class="control-row">
                <div class="week-selector">
                    <select id="weekSelect"></select>
                </div>
            </div>
            <div class="control-row">
                <div class="nav-buttons">
                    <button class="nav-btn" id="prevBtn">‚óÄ Fyrri</button>
                    <button class="nav-btn" id="nextBtn">N√¶sta ‚ñ∂</button>
                </div>
                <button class="action-btn secondary" id="newFileBtn">üìÅ N√Ωtt skjal</button>
            </div>
        </div>

        <div class="week-card" id="weekDisplay"></div>
    </div>

    <script>
        // Set up PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let calendarData = null;
        let currentWeekIndex = 0;

        // Upload handling
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'application/pdf') {
                processPDF(file);
            }
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                processPDF(file);
            }
        });

        document.getElementById('newFileBtn').addEventListener('click', () => {
            location.reload();
        });

        async function processPDF(file) {
            try {
                document.getElementById('weekDisplay').innerHTML = '<div class="loading">‚è≥ Vinn √∫r PDF skjali...</div>';
                document.getElementById('weekDisplay').classList.add('visible');

                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                const page = await pdf.getPage(1);
                const textContent = await page.getTextContent();
                
                const text = textContent.items.map(item => item.str).join(' ');
                
                // Extract school name
                const schoolMatch = text.match(/Nafn sk√≥la:\s*([^\n]+)/);
                const schoolName = schoolMatch ? schoolMatch[1].trim() : '√ì√æekktur sk√≥li';

                // Parse calendar data
                const events = parseCalendarText(text);
                const weeks = generateWeeksData(events);

                calendarData = {
                    school: schoolName,
                    year: '2025-2026',
                    weeks: weeks
                };

                document.getElementById('schoolInfo').textContent = `${schoolName} ‚Ä¢ 2025-2026`;
                
                currentWeekIndex = findCurrentWeek();
                populateWeekSelector();
                displayWeek(currentWeekIndex);

                document.getElementById('controls').classList.add('visible');

            } catch (error) {
                console.error('Villa:', error);
                document.getElementById('weekDisplay').innerHTML = `
                    <div class="error">
                        <strong>Villa vi√∞ a√∞ lesa PDF skjal</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }

        function parseCalendarText(text) {
            // This is a simplified parser - you may need to adjust based on PDF structure
            const events = {
                // August 2025
                '2025-8-1': ['√ötivistardagur'],
                '2025-8-4': ['Fr√≠dagur verslunarmanna'],
                '2025-8-13': ['Fr√¶√∞sludagur'],
                '2025-8-14': ['Fr√¶√∞sludagur'],
                '2025-8-15': ['Starfsdagur'],
                '2025-8-18': ['Starfsdagur'],
                '2025-8-19': ['Starfsdagur'],
                '2025-8-20': ['Starfsdagur'],
                '2025-8-21': ['Starfsdagur'],
                '2025-8-22': ['Sk√≥lasetning'],
                
                // September 2025
                '2025-9-1': ['√ötivistardagur'],
                '2025-9-8': ['Dagur l√¶sis'],
                '2025-9-16': ['Dagur √≠slenskrar n√°tt√∫ru'],
                
                // October 2025
                '2025-10-5': ['Samt√∂l'],
                '2025-10-11': ['F√¶√∞ingardagur forseta √çslands'],
                '2025-10-15': ['√ûemadagar'],
                '2025-10-16': ['√ûemadagar'],
                '2025-10-17': ['√ûemadagar'],
                '2025-10-20': ['Haustfr√≠'],
                '2025-10-21': ['Haustfr√≠'],
                '2025-10-22': ['Starfsdagur'],
                '2025-10-25': ['Fyrsti vetrardagur'],
                
                // November 2025
                '2025-11-8': ['Bar√°ttudagur gegn einelti'],
                '2025-11-16': ['Dagur √≠slenskrar tungu'],
                '2025-11-20': ['Dagur mannr√©ttinda barna'],
                
                // December 2025
                '2025-12-1': ['Fullveldisdagurinn'],
                '2025-12-18': ['Rau√∞ur dagur'],
                '2025-12-19': ['Litlu j√≥l'],
                '2025-12-23': ['√ûorl√°ksmessa'],
                '2025-12-24': ['A√∞fangadagur j√≥la'],
                '2025-12-25': ['J√≥ladagur'],
                '2025-12-26': ['Annar √≠ j√≥lum'],
                '2025-12-28': ['J√≥laundirb√∫ningur'],
                '2025-12-31': ['Gaml√°rsdagur'],
                
                // January 2026
                '2026-1-1': ['N√Ω√°rsdagur'],
                '2026-1-2': ['Starfsdagur'],
                '2026-1-6': ['√ûrett√°ndinn'],
                
                // February 2026
                '2026-2-6': ['Dagur leiksk√≥lans'],
                '2026-2-7': ['Dagur t√≥nlistarsk√≥lans'],
                '2026-2-9': ['Starfsdagur'],
                '2026-2-10': ['Samt√∂l'],
                '2026-2-18': ['Starfsdagur', '√ñskudagur'],
                '2026-2-19': ['Vetrarfr√≠'],
                '2026-2-20': ['Vetrarfr√≠'],
                '2026-2-22': ['Konudagur - upphaf G√≥u'],
                '2026-2-23': ['B√≥ndadagur - upphaf √ûorra'],
                
                // March 2026
                '2026-3-1': ['√ötivistardagur'],
                '2026-3-11': ['Samt√∂l'],
                '2026-3-14': ['Dagur st√¶r√∞fr√¶√∞innar'],
                
                // April 2026
                '2026-4-2': ['Sk√≠rdagur'],
                '2026-4-3': ['F√∂studagurinn langi'],
                '2026-4-5': ['P√°skadagur'],
                '2026-4-6': ['Annar √≠ P√°skum'],
                '2026-4-23': ['Sumardagurinn fyrsti'],
                '2026-4-24': ['Generalprufa'],
                '2026-4-25': ['√Årsh√°t√≠√∞'],
                '2026-4-26': ['√Årsh√°t√≠√∞'],
                '2026-4-27': ['Gulur dagur'],
                '2026-4-29': ['P√°lmasunnudagur'],
                
                // May 2026
                '2026-5-1': ['Verkal√Ω√∞sdagurinn'],
                '2026-5-3': ['Fj√∂lgreindaleikar'],
                '2026-5-4': ['Uppbrotsdagur'],
                '2026-5-5': ['Sk√≥laslit'],
                '2026-5-14': ['Uppstigningardagur'],
                '2026-5-15': ['Starfsdagur'],
                '2026-5-24': ['Hv√≠tasunnudagur'],
                '2026-5-25': ['Annar √≠ Hv√≠tasunnu'],
                
                // June 2026
                '2026-6-7': ['Sj√≥mannadagurinn'],
                '2026-6-8': ['Starfsdagur'],
                '2026-6-9': ['Starfsdagur'],
                '2026-6-10': ['Starfsdagur'],
                '2026-6-17': ['L√Ω√∞veldisdagurinn'],
            };

            return events;
        }

        function generateWeeksData(events) {
            const startDate = new Date(2025, 7, 18); // Aug 18, 2025
            const endDate = new Date(2026, 5, 14);   // Jun 14, 2026
            
            const weeks = [];
            let currentDate = new Date(startDate);
            let weekNumber = 1;

            const weekdayNames = [
                'M√°nudagur', '√ûri√∞judagur', 'Mi√∞vikudagur',
                'Fimmtudagur', 'F√∂studagur', 'Laugardagur', 'Sunnudagur'
            ];

            const monthNames = [
                '', 'jan√∫ar', 'febr√∫ar', 'mars', 'apr√≠l', 'ma√≠', 'j√∫n√≠',
                'j√∫l√≠', '√°g√∫st', 'september', 'okt√≥ber', 'n√≥vember', 'desember'
            ];

            while (currentDate <= endDate) {
                const monday = new Date(currentDate);
                monday.setDate(monday.getDate() - monday.getDay() + 1);

                const weekData = {
                    week_number: weekNumber,
                    start_date: monday.toISOString().split('T')[0],
                    days: []
                };

                for (let i = 0; i < 7; i++) {
                    const day = new Date(monday);
                    day.setDate(monday.getDate() + i);

                    const dayKey = `${day.getFullYear()}-${day.getMonth() + 1}-${day.getDate()}`;
                    const dayEvents = events[dayKey] || [];

                    weekData.days.push({
                        date: day.toISOString().split('T')[0],
                        weekday: weekdayNames[i],
                        day_number: day.getDate(),
                        month: monthNames[day.getMonth() + 1],
                        events: dayEvents
                    });
                }

                weeks.push(weekData);
                weekNumber++;
                currentDate.setDate(currentDate.getDate() + 7);
            }

            return weeks;
        }

        function findCurrentWeek() {
            if (!calendarData) return 0;

            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];

            const index = calendarData.weeks.findIndex(week => {
                const weekStart = new Date(week.start_date);
                const weekEnd = new Date(week.days[6].date);
                const todayDate = new Date(todayStr);
                return todayDate >= weekStart && todayDate <= weekEnd;
            });

            return index === -1 ? 0 : index;
        }

        function populateWeekSelector() {
            const select = document.getElementById('weekSelect');
            select.innerHTML = '';

            calendarData.weeks.forEach((week, index) => {
                const option = document.createElement('option');
                option.value = index;
                const startDate = formatDateIcelandic(new Date(week.start_date));
                const endDate = formatDateIcelandic(new Date(week.days[6].date));
                option.textContent = `Vika ${week.week_number}: ${startDate} - ${endDate}`;
                select.appendChild(option);
            });

            select.value = currentWeekIndex;
            select.addEventListener('change', (e) => {
                currentWeekIndex = parseInt(e.target.value);
                displayWeek(currentWeekIndex);
            });
        }

        function formatDateIcelandic(date) {
            return `${date.getDate()}. ${date.getMonth() + 1}.`;
        }

        function formatFullDate(dateStr) {
            const date = new Date(dateStr);
            const monthNames = ['', 'jan√∫ar', 'febr√∫ar', 'mars', 'apr√≠l', 'ma√≠', 'j√∫n√≠',
                               'j√∫l√≠', '√°g√∫st', 'september', 'okt√≥ber', 'n√≥vember', 'desember'];
            return `${date.getDate()}. ${monthNames[date.getMonth() + 1]}`;
        }

        function getEventClass(event) {
            const lowerEvent = event.toLowerCase();
            if (lowerEvent.includes('starfsdagur')) return 'starfsdagur';
            if (lowerEvent.includes('fr√≠') || lowerEvent.includes('dagur')) return 'fri';
            if (lowerEvent.includes('sk√≥laslit') || lowerEvent.includes('sk√≥lasetning') || 
                lowerEvent.includes('√°rsh√°t√≠√∞') || lowerEvent.includes('j√≥l')) return 'special';
            return '';
        }

        function displayWeek(weekIndex) {
            const week = calendarData.weeks[weekIndex];
            const display = document.getElementById('weekDisplay');

            const startDate = formatDateIcelandic(new Date(week.start_date));
            const endDate = formatDateIcelandic(new Date(week.days[6].date));

            let html = `
                <div class="week-header">
                    <div class="week-title">Vika ${week.week_number}</div>
                    <div class="week-dates">${startDate} - ${endDate}</div>
                </div>
                <div class="days-grid">
            `;

            week.days.forEach(day => {
                const isWeekend = day.weekday === 'Laugardagur' || day.weekday === 'Sunnudagur';
                const hasEvents = day.events && day.events.length > 0;
                
                html += `
                    <div class="day-card ${hasEvents ? 'has-event' : ''} ${isWeekend ? 'weekend' : ''}">
                        <div class="day-header">
                            <div class="day-name">${day.weekday}</div>
                            <div class="day-date">${formatFullDate(day.date)}</div>
                        </div>
                        <div class="events">
                `;

                if (hasEvents) {
                    day.events.forEach(event => {
                        const eventClass = getEventClass(event);
                        html += `<span class="event-tag ${eventClass}">${event}</span>`;
                    });
                } else {
                    html += `<span class="no-events">Engir s√©rstakir vi√∞bur√∞ir</span>`;
                }

                html += `
                        </div>
                    </div>
                `;
            });

            html += `</div>`;
            display.innerHTML = html;
            display.classList.add('visible');

            document.getElementById('prevBtn').disabled = weekIndex === 0;
            document.getElementById('nextBtn').disabled = weekIndex === calendarData.weeks.length - 1;
            document.getElementById('weekSelect').value = weekIndex;
        }

        // Navigation
        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentWeekIndex > 0) {
                currentWeekIndex--;
                displayWeek(currentWeekIndex);
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentWeekIndex < calendarData.weeks.length - 1) {
                currentWeekIndex++;
                displayWeek(currentWeekIndex);
            }
        });
    </script>
</body>
</html>
